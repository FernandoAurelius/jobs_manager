<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Job Detail</title>
</head>
<body>
    <h1>Job Details</h1>
    <p>Job Name: {{ job.name }}</p>
    <p>Client Name: {{ job.client_name }}</p>
    <p>Order Number: {{ job.order_number }}</p>
    <p>Contact Person: {{ job.contact_person }}</p>
    <p>Contact Phone: {{ job.contact_phone }}</p>
    <p>Job Number: {{ job.job_number }}</p>
    <p>Description: {{ job.description }}</p>
    <p>Status: {{ job.status }}</p>
    <p>Paid: {{ job.paid }}</p>

    <h2>Job Financials</h2>
    {% for pricing in pricing_data %}
        <h3>{{ pricing.model.pricing_type|title }} Pricing</h3>
        <ul>
            <li>Total Time Cost: ${{ pricing.total_time_cost }}</li>
            <li>Total Time Revenue: ${{ pricing.total_time_revenue }}</li>
            <li>Total Material Cost: ${{ pricing.total_material_cost }}</li>
            <li>Total Material Revenue: ${{ pricing.total_material_revenue }}</li>
            <li>Total Adjustment Cost: ${{ pricing.total_adjustment_cost }}</li>
            <li>Total Adjustment Revenue: ${{ pricing.total_adjustment_revenue }}</li>
            <li>Total Cost: ${{ pricing.total_cost }}</li>
            <li>Total Revenue: ${{ pricing.total_revenue }}</li>
        </ul>
    {% endfor %}

    <h2>Time Entries</h2>
    <ul>
        {% for entry in job.time_entries.all %}
            <li>{{ entry.date }} - {{ entry.hours }} hours - Cost: ${{ entry.cost }} - Revenue: ${{ entry.revenue }}</li>
        {% endfor %}
    </ul>

    <h2>Material Entries</h2>
    <ul>
        {% for entry in job.material_entries.all %}
            <li>{{ entry.description }} - Quantity: {{ entry.quantity }} - Cost: ${{ entry.cost }} - Revenue: ${{ entry.revenue }}</li>
        {% endfor %}
    </ul>

    <h2>Adjustment Entries</h2>
    <ul>
        {% for entry in job.adjustment_entries.all %}
            <li>{{ entry.description }} - Cost: ${{ entry.cost }} - Revenue: ${{ entry.revenue }}</li>
        {% endfor %}
    </ul>

        <h2>Job History</h2>
    <ul>
        {% if history_diffs %}
            {% for entry, diff in history_diffs %}
                <li>
                    {{ entry.history_date }} - {{ entry.get_history_type_display }}
                    {% if entry.history_user %}
                        by {{ entry.history_user.get_full_name }} ({{ entry.history_user.email }})
                    {% endif %}
                    {% if diff %}
                        <ul>
                            {% for field, change in diff.items %}
                                <li>{{ field }}: {{ change.0 }} -> {{ change.1 }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>
            {% endfor %}
        {% else %}
            <li>No history available.</li>
        {% endif %}
    </ul>

    <h3>Debug Information</h3>
    <p>History Count: {{ history_diffs|length }}</p>
    <p>Job Data: {{ job }}</p>
</body>
</html>
