{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/edit_job.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
{% endblock %}

{% block content %}
<div class="container-fluid mt-3">
    <!-- Row 1: Job details at the top -->
    <div class="row mb-3">
        <div class="col-md-12">
            <h4>Job Details</h4>
            <form id="jobForm" method="POST">
                {% csrf_token %}
                <!-- Job details inputs go here -->
                <!-- (contract, customer, phone contact, site, etc.) -->
            </form>
        </div>
    </div>

    <!-- Subtle screen divider -->
    <hr />

<div class="container">
    <h1>Job Details</h1>

    <!-- Customer and Contract Information with AJAX -->
    <div class="row mb-4">
        <div class="col-6">
            <label for="customerName" class="form-label">Customer</label>
            <input type="text" id="customerName" class="form-control" placeholder="Enter customer name (AJAX)">
        </div>
        <div class="col-6">
            <label for="contract" class="form-label">Contract</label>
            <input type="text" id="contract" class="form-control" placeholder="Enter contract (AJAX)">
        </div>
    </div>

    <!-- Phone Contact, Quote Number, and Date -->
    <div class="row mb-4">
        <div class="col-4">
            <label for="phoneContact" class="form-label">Phone Contact</label>
            <input type="text" id="phoneContact" class="form-control" placeholder="Enter phone contact">
        </div>
        <div class="col-4">
            <label for="quoteNumber" class="form-label">Quote Number</label>
            <input type="text" id="quoteNumber" class="form-control" placeholder="Auto-generated" disabled>
        </div>
        <div class="col-4">
            <label for="date" class="form-label">Date</label>
            <input type="date" id="date" class="form-control" value="2024-09-19">
        </div>
    </div>

    <!-- Default Markup Percentages -->
    <div class="row mb-4">
        <div class="col-6">
            <label for="timeMarkup" class="form-label">Time Markup (%)</label>
            <input type="number" id="timeMarkup" class="form-control" placeholder="Enter time markup" value="30">
        </div>
        <div class="col-6">
            <label for="materialsMarkup" class="form-label">Materials Markup (%)</label>
            <input type="number" id="materialsMarkup" class="form-control" placeholder="Enter materials markup" value="20">
        </div>
    </div>

    <!-- Estimates Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h2>Estimates</h2>
            <div id="estimateTimeTable" class="mb-3"></div>
            <div id="estimateMaterialsTable" class="mb-3"></div>
            <div id="estimateAdjustmentsTable" class="mb-3"></div>
        </div>
    </div>

        <!-- "Copy Estimate to Quote" Button -->
    <div class="row mb-4">
        <div class="col-12">
            <button type="button" class="btn btn-success" id="copyEstimateButton">Copy Estimate to Quote</button>
        </div>
    </div>

    <!-- Quotes Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h2>Quotes</h2>
            <div id="quoteTimeTable" class="mb-3"></div>
            <div id="quoteMaterialsTable" class="mb-3"></div>
            <div id="quoteAdjustmentsTable" class="mb-3"></div>
        </div>
    </div>

    <!-- "Send Quote to Customer" Button -->
    <div class="row mb-4">
        <div class="col-12">
            <button type="button" class="btn btn-info" id="sendQuoteButton">Send Quote to Customer</button>
        </div>
    </div>

    <!-- Reality Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h2>Reality</h2>
            <div id="realityTimeTable" class="mb-3"></div>
            <div id="realityMaterialsTable" class="mb-3"></div>
            <div id="realityAdjustmentsTable" class="mb-3"></div>
        </div>
    </div>

    <!-- Project Totals Section -->
    <div class="row mb-4">
        <div class="col-12">
            <h2>Project Totals</h2>
            <div id="totalsTable"></div>
        </div>
    </div>

    <!-- Paid and History after Totals -->
    <div class="row mb-4">
        <div class="col-6">
            <label for="paid" class="form-label">Paid</label>
            <input type="checkbox" id="paid" class="form-check-input">
        </div>
        <div class="col-6">
            <label for="history" class="form-label">Job History</label>
            <textarea id="history" class="form-control" rows="3" placeholder="Job history..."></textarea>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-4">
        <div class="col-12">
            <button type="submit" class="btn btn-primary btn-lg" id="saveButton">Save</button>
            <button type="button" class="btn btn-secondary btn-lg" onclick="window.location.href='/'">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<script src="{% static 'js/edit_job.js' %}"></script>
{% endblock %}
