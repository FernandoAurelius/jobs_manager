{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/kanban-enhanced.css' %}">
<link rel="stylesheet" href="{% static 'css/job-cards.css' %}">
{% endblock %}

{% block content %}

<div id="monthEndModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Select Jobs for Month-End Processing</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="monthEndForm">
          <label for="jobSelector" class="form-label">Jobs</label>
          <select id="jobSelector" class="form-select" multiple>
            {% for job in jobs %}
            <option value="{{ job.id }}">{{ job.name }}</option>
            {% endfor %}
          </select>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          <i class="bi bi-x-circle me-1"></i>Close
        </button>
        <button type="button" id="confirmMonthEnd" class="btn btn-primary">
          <i class="bi bi-calendar-check me-1"></i>Process
        </button>
      </div>
    </div>
  </div>
</div> 

<div class="search-container">
  <input type="text" id="search" class="form-control" placeholder="🔍 Search jobs...">

  <div class="left-container">
    <button id="monthEndButton" class="btn btn-primary btn-sm" style="display:none;">
      <i class="bi bi-calendar-month me-1"></i>Month End
    </button>
    <div class="job-controls">
      <label for="jobPageSize" class="form-label small mb-0">Per page:</label>
      <select id="jobPageSize" class="form-select form-select-sm" style="width: 60px">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
      </select>
    </div>
  </div>
</div>

<div class="kanban-board">
  {% for status_key, status_label in status_choices %}
  {% if status_key != "archived" %}
  <div id="{{ status_key }}" class="kanban-column">
      <div class="column-header">{{ status_label }} (<span id="{{ status_key }}-count">0</span>/<span id="{{ status_key }}-total">0</span>)</div>
      <div class="job-list"></div>
      
      <div id="{{ status_key }}-load-more-container" class="load-more-container mb-2" style="display: none;">
          <button id="{{ status_key }}-load-more" class="load-more btn btn-secondary btn-sm" data-status="{{ status_key }}">
              <i class="bi bi-arrow-down me-1"></i>More
          </button>
      </div>
  </div>
  {% endif %}
  {% endfor %}  
</div>

<div class="archive-section">
  <div class="archive-header">
    <h3 class="archive-title">
      <i class="bi bi-archive"></i> Archived Jobs 
      (<span id="archived-count">0</span>/<span id="archived-total">0</span>)
    </h3>
    <button class="archive-toggle" id="toggleArchive">
      <i class="bi bi-chevron-down"></i>
    </button>
  </div>
  
  <div id="archiveContainer" class="archive-grid" style="display: none;">
    <div id="archived" class="kanban-column">
      <div class="job-list"></div>
      <div id="archived-load-more-container" class="load-more-container mb-2" style="display: none;">
        <button id="archived-load-more" class="load-more btn btn-secondary btn-sm" data-status="archived">
          <i class="bi bi-arrow-down me-1"></i>More
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'sortablejs/Sortable.min.js' %}"></script>
<script src="{% static 'js/kanban.js' %}"></script>
<script>
  // Toggle archive section visibility
  document.getElementById('toggleArchive').addEventListener('click', function() {
    const archiveContainer = document.getElementById('archiveContainer');
    const toggleIcon = this.querySelector('i');
    
    if (archiveContainer.style.display === 'none') {
      archiveContainer.style.display = 'grid';
      toggleIcon.classList.remove('bi-chevron-down');
      toggleIcon.classList.add('bi-chevron-up');
    } else {
      archiveContainer.style.display = 'none';
      toggleIcon.classList.remove('bi-chevron-up');
      toggleIcon.classList.add('bi-chevron-down');
    }
  });
</script>
{% endblock %}